# Haiku éªŒè¯æµç¨‹

æœ¬æ–‡æ¡£æŒ‡å¯¼ä½ ä½¿ç”¨ Haiku æ¨¡å‹éªŒè¯æµ‹è¯•é¢˜çš„åˆç†æ€§ã€‚

---

## ç›®çš„

**Haiku éªŒè¯**ï¼šç”¨è¾ƒå¼±çš„æ¨¡å‹æµ‹è¯•é¢˜ç›®æ˜¯å¦åˆç†ã€‚

**æ ¸å¿ƒåŸåˆ™**ï¼š
- Haiku åªèƒ½çœ‹åˆ° **Query** å’Œ **ç¯å¢ƒæ–‡ä»¶**
- Haiku **ä¸èƒ½çœ‹åˆ°** ç­”æ¡ˆï¼ˆreference_solution å’Œ gradersï¼‰
- Haiku è‡ªå·±æ¢ç´¢å’Œè§£é¢˜
- é€šè¿‡ Haiku çš„è¡¨ç°åˆ¤æ–­é¢˜ç›®éš¾åº¦æ˜¯å¦åˆç†

---

## ç¯å¢ƒéš”ç¦»åŸç†

### ä¸ºä»€ä¹ˆè¦éš”ç¦»ï¼Ÿ

1. **Haiku ä¼šä¿®æ”¹æ–‡ä»¶**
   - Edit å·¥å…·ä¼šä¿®æ”¹é…ç½®æ–‡ä»¶
   - ä¿®æ”¹ä¼šæ±¡æŸ“åŸå§‹ç¯å¢ƒ

2. **éœ€è¦ä¿ç•™åŸå§‹ç¯å¢ƒ**
   - ä½ éœ€è¦åŸå§‹çš„ environment æ¥ä¿å­˜é¢˜ç›®
   - åŸå§‹çš„ case.json åŒ…å«ç­”æ¡ˆï¼Œä¸èƒ½è¢« Haiku çœ‹åˆ°

3. **é˜²æ­¢æ³„éœ²ç­”æ¡ˆ**
   - case.json åŒ…å« reference_solutionï¼ˆç­”æ¡ˆï¼‰
   - å¦‚æœ Haiku èƒ½è¯»å– case.jsonï¼Œå°±èƒ½ä½œå¼Š

### éš”ç¦»æ–¹æ¡ˆ

åœ¨å·¥ä½œç›®å½•ä¸‹åˆ›å»º `haiku_space/` å­ç›®å½•ï¼š

```
/tmp/workspace/
â”œâ”€â”€ config/                   # åŸå§‹ç¯å¢ƒï¼ˆä¿ç•™ï¼‰
â”œâ”€â”€ logs/
â”œâ”€â”€ docs/
â”œâ”€â”€ case.json                 # åŒ…å«ç­”æ¡ˆï¼ˆä¸å¤åˆ¶åˆ° haiku_spaceï¼‰
â”œâ”€â”€ phase4_result.json
â”‚
â””â”€â”€ haiku_space/              # Haiku å·¥ä½œç›®å½•ï¼ˆéš”ç¦»ï¼‰
    â”œâ”€â”€ config/               # å¤åˆ¶çš„ç¯å¢ƒæ–‡ä»¶
    â”œâ”€â”€ logs/
    â”œâ”€â”€ docs/
    â””â”€â”€ phase6_result.json    # Haiku éªŒè¯ç»“æœ
```

**å…³é”®ç‚¹**ï¼š
- âœ… å¤åˆ¶ç¯å¢ƒæ–‡ä»¶åˆ° `haiku_space/`
- âŒ **ä¸è¦**å¤åˆ¶ `case.json`ï¼ˆåŒ…å«ç­”æ¡ˆï¼‰
- âœ… Haiku å·¥ä½œç›®å½•è®¾ç½®ä¸º `haiku_space/`
- âœ… Haiku åªèƒ½çœ‹åˆ°å’Œä¿®æ”¹ `haiku_space/` å†…çš„æ–‡ä»¶

---

## æ‰§è¡Œæ­¥éª¤

### Step 1: å‡†å¤‡ Haiku ç¯å¢ƒ

åˆ›å»º `haiku_space/` å­ç›®å½•å¹¶å¤åˆ¶ç¯å¢ƒæ–‡ä»¶ï¼š

```bash
# åˆ›å»ºéš”ç¦»ç›®å½•
mkdir -p haiku_space

# å¤åˆ¶æ‰€æœ‰ç¯å¢ƒæ–‡ä»¶
cp -r config/ haiku_space/
cp -r logs/ haiku_space/
cp -r docs/ haiku_space/
cp -r services/ haiku_space/
# ... å¤åˆ¶æ‰€æœ‰ç¯å¢ƒç›®å½•å’Œæ–‡ä»¶
```

**âš ï¸ é‡è¦**ï¼š
- âœ… å¤åˆ¶ environment ä¸­åˆ—å‡ºçš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•
- âŒ **ä¸è¦**å¤åˆ¶ `case.json`ï¼ˆåŒ…å«ç­”æ¡ˆï¼‰
- âŒ **ä¸è¦**å¤åˆ¶ `phase4_result.json`ï¼ˆéªŒè¯ç»“æœï¼‰

### Step 2: è°ƒç”¨ Haiku éªŒè¯è„šæœ¬

ä½¿ç”¨ç»å¯¹è·¯å¾„è°ƒç”¨éªŒè¯è„šæœ¬ï¼š

```bash
python3 ~/.claude/skills/agent-testcase-generator/scripts/phase6_haiku.py case.json --haiku-dir haiku_space/
```

**è„šæœ¬ä¼šè‡ªåŠ¨**ï¼š
1. è¯»å– case.jsonï¼ˆä»å·¥ä½œç›®å½•æ ¹ï¼‰
2. æå– Queryï¼ˆtask.descï¼‰
3. è¿›å…¥ haiku_space/ ç›®å½•
4. è°ƒç”¨ Haiku CLIï¼Œåªç»™ Queryï¼Œä¸ç»™ç­”æ¡ˆ
5. Haiku åœ¨ haiku_space/ ä¸­æ¢ç´¢å’Œè§£é¢˜
6. æ•è· Haiku çš„çœŸå®å·¥å…·è°ƒç”¨è½¨è¿¹
7. ç”¨ graders éªŒè¯ haiku_space/ çš„çŠ¶æ€
8. ä¿å­˜ç»“æœåˆ° `haiku_space/phase6_result.json`

**æ‰§è¡Œæ—¶é—´**ï¼šé€šå¸¸éœ€è¦ 30-120 ç§’ï¼Œå–å†³äºé¢˜ç›®å¤æ‚åº¦

### Step 3: ç­‰å¾…è„šæœ¬å®Œæˆ

è„šæœ¬ä¼šè¾“å‡ºå®æ—¶è¿›åº¦ï¼š

```
=== Phase 6 Haiku éªŒè¯å¼€å§‹ ===
å‡†å¤‡ Haiku ç¯å¢ƒ: /tmp/workspace/haiku_space/
Haiku å·¥ä½œç›®å½•: /tmp/workspace/haiku_space/
è°ƒç”¨ Haiku CLI...
Query: "è®¢å•æœåŠ¡æ•°æ®åº“è¿æ¥è¶…æ—¶ï¼Œè¯·æ’æŸ¥é…ç½®é—®é¢˜"
Haiku æ‰§è¡Œä¸­...
  Step 1: Read logs/error.log
  Step 2: Grep timeout
  Step 3: Read docs/incident-2847.md
  Step 4: Read config/database.yaml
  Step 5: Edit config/database.yaml
Haiku æ‰§è¡Œå®Œæˆï¼Œå…± 5 æ­¥
éªŒè¯ Graders...
  state_check: 3/3 é€šè¿‡ âœ“
  tool_calls: 1/1 é€šè¿‡ âœ“
=== Phase 6 éªŒè¯é€šè¿‡ ===
ç»“æœå·²ä¿å­˜: /tmp/workspace/haiku_space/phase6_result.json
```

### Step 4: è¯»å–éªŒè¯ç»“æœ

```bash
Read haiku_space/phase6_result.json
```

**ç»“æœç»“æ„**ï¼š
```json
{
  "passed": true,
  "haiku_steps": 5,
  "duration_sec": 45,
  "haiku_evaluation": {
    "passed": true,
    "haiku_steps": 5,
    "duration_sec": 45,
    "passed_checks": 4,
    "total_checks": 4
  },
  "haiku_execution": {
    "trajectory": [
      {
        "step": 1,
        "tool": "Read",
        "input": {"file_path": "logs/error.log"},
        "output": "Connection refused on port 5432\nDatabase: db-prod-01\n..."
      },
      {
        "step": 2,
        "tool": "Grep",
        "input": {"pattern": "timeout", "output_mode": "files_with_matches"},
        "output": "config/database.yaml\ndocs/incident-2847.md"
      },
      ...
    ]
  }
}
```

### Step 5: æå–è½¨è¿¹æ•°æ®

**ğŸš¨ å¼ºåˆ¶è¦æ±‚**ï¼šå¿…é¡»åŸå°ä¸åŠ¨å¤åˆ¶ `haiku_trajectory`

ä» `phase6_result.json` ä¸­æå–ä»¥ä¸‹å­—æ®µï¼Œå¤åˆ¶åˆ°æœ€ç»ˆçš„ `case.json`ï¼š

1. **haiku_evaluation**ï¼š
   ```json
   "haiku_evaluation": {
     "passed": true,
     "haiku_steps": 5,
     "duration_sec": 45,
     "passed_checks": 4,
     "total_checks": 4
   }
   ```

2. **haiku_trajectory**ï¼ˆä» `haiku_execution.trajectory` å¤åˆ¶ï¼‰ï¼š
   ```json
   "haiku_trajectory": [
     {
       "step": 1,
       "tool": "Read",
       "input": {"file_path": "logs/error.log"},
       "output": "å®Œæ•´çš„åŸå§‹å·¥å…·è¾“å‡ºï¼ˆæœ€å¤š500å­—ç¬¦ï¼‰"
     },
     ...
   ]
   ```

**âš ï¸ ä¸¥ç¦**ï¼š
- âŒ ç¼–é€ è½¨è¿¹æ•°æ®
- âŒ æ€»ç»“æˆ–æ”¹å†™ outputï¼ˆå¿…é¡»æ˜¯åŸå§‹è¾“å‡ºï¼‰
- âŒ æ·»åŠ  reasoning å­—æ®µï¼ˆçœŸå®è½¨è¿¹æ²¡æœ‰è¿™ä¸ªå­—æ®µï¼‰
- âŒ ç®€åŒ–æˆ–çœç•¥ä»»ä½•æ­¥éª¤

**éªŒè¯çœŸå®æ€§**ï¼š
- âœ… output æ˜¯å®Œæ•´çš„åŸå§‹å·¥å…·è¿”å›ï¼ˆå¯èƒ½è¢«æˆªæ–­åˆ° 500 å­—ç¬¦ï¼‰
- âœ… æ²¡æœ‰ reasoning å­—æ®µ
- âœ… ä¸ phase6_result.json ä¸­çš„æ•°æ®å®Œå…¨ä¸€è‡´

---

## åˆ†æç»“æœ

### æƒ…å†µ 1ï¼šHaiku é€šè¿‡ï¼Œæ­¥æ•°åˆç†

```
passed: true
haiku_steps: 5ï¼ˆæ¥è¿‘ Golden Action çš„ 5 æ­¥ï¼‰
```

**ç»“è®º**ï¼šé¢˜ç›®åˆç†ï¼Œéš¾åº¦é€‚ä¸­

**ä¸‹ä¸€æ­¥**ï¼šå®Œæˆæœ€ç»ˆè¾“å‡º

### æƒ…å†µ 2ï¼šHaiku é€šè¿‡ï¼Œæ­¥æ•°å¤ªå°‘

```
passed: true
haiku_steps: 2ï¼ˆGolden Action æ˜¯ 5 æ­¥ï¼‰
```

**åŸå› **ï¼šé¢˜ç›®å¤ªç®€å•ï¼Œä¿¡æ¯ä¸å¤Ÿåˆ†æ•£

**å›ç‚‰ç­–ç•¥**ï¼š
- å¢åŠ ä¿¡æ¯åˆ†æ•£åº¦ï¼ˆå°†ç­”æ¡ˆè—åœ¨æ›´å¤šæ–‡ä»¶ä¸­ï¼‰
- æ·»åŠ æ›´å¤šå¹²æ‰°æ–‡ä»¶
- è°ƒæ•´ Query æ¨¡ç³Šåº¦

**é™åˆ¶**ï¼šåªå›ç‚‰ä¸€æ¬¡ï¼Œä¸ç®¡ç»“æœå¦‚ä½•éƒ½è¦è¾“å‡º

### æƒ…å†µ 3ï¼šHaiku å¤±è´¥ï¼Œç¯å¢ƒ/Query é—®é¢˜

```
passed: false
åŸå› ï¼šHaiku æ‰¾ä¸åˆ°å…³é”®ä¿¡æ¯ï¼Œæˆ– Query æœ‰æ­§ä¹‰
```

**åˆ¤æ–­æ˜¯å¦æ˜¯å‡ºé¢˜é—®é¢˜**ï¼š
- Query æ˜¯å¦æœ‰æ­§ä¹‰ï¼Ÿ
- ç¯å¢ƒä¸­æ˜¯å¦ç¼ºå°‘å…³é”®çº¿ç´¢ï¼Ÿ
- Grader æ˜¯å¦è¿‡ä¸¥ï¼Ÿ

**å›ç‚‰ç­–ç•¥**ï¼š
- ä¿®å¤ Query æ­§ä¹‰
- è¡¥å……ç¯å¢ƒçº¿ç´¢
- è°ƒæ•´ Grader éªŒè¯æ¡ä»¶

**é™åˆ¶**ï¼šåªå›ç‚‰ä¸€æ¬¡

### æƒ…å†µ 4ï¼šHaiku å¤±è´¥ï¼Œèƒ½åŠ›ä¸è¶³

```
passed: false
åŸå› ï¼šHaiku èƒ½åŠ›ä¸è¶³ï¼Œæ— æ³•å®Œæˆé«˜éš¾åº¦é¢˜ç›®ï¼ˆD5+ï¼‰
```

**ç»“è®º**ï¼šå¯æ¥å—ï¼Œè¿™æ˜¯æ­£å¸¸çš„

**è¯´æ˜**ï¼š
- D5+ é¢˜ç›®æœ¬æ¥å°±æ˜¯ä¸ºå¼ºæ¨¡å‹è®¾è®¡çš„
- Haiku å¤±è´¥è¯´æ˜é¢˜ç›®æœ‰ä¸€å®šéš¾åº¦
- å…³é”®æ˜¯é¢˜ç›®è®¾è®¡æ˜¯å¦åˆç†ï¼Œè€Œä¸æ˜¯ Haiku æ˜¯å¦é€šè¿‡

---

## å›ç‚‰ä¿®å¤ï¼ˆå¦‚éœ€è¦ï¼‰

### ä½•æ—¶å›ç‚‰

ä»¥ä¸‹æƒ…å†µéœ€è¦å›ç‚‰ï¼š
- Haiku é€šè¿‡ä½†æ­¥æ•°æ˜æ˜¾å¤ªå°‘ï¼ˆè¯´æ˜å¤ªç®€å•ï¼‰
- Haiku å¤±è´¥ä¸”åŸå› æ˜¯ Query æ­§ä¹‰æˆ–ç¯å¢ƒé—®é¢˜
- Grader è¿‡ä¸¥å¯¼è‡´åˆç†è§£æ³•æ— æ³•é€šè¿‡

### å›ç‚‰é™åˆ¶

**åªèƒ½å›ç‚‰ä¸€æ¬¡**ï¼Œä¸ç®¡ç»“æœå¦‚ä½•éƒ½è¦è¾“å‡ºæœ€ç»ˆæ•°æ®ã€‚

### å¯ä»¥ä¿®æ”¹çš„éƒ¨åˆ†

å›ç‚‰æ—¶**å¯ä»¥**ä¿®æ”¹ï¼š

1. **Query**
   - ä¿®å¤æ­§ä¹‰
   - è°ƒæ•´æ¨¡ç³Šåº¦

2. **Grader**
   - è°ƒæ•´éªŒè¯æ¡ä»¶
   - å…è®¸åˆç†çš„æ›¿ä»£æ–¹æ¡ˆ

3. **Environment å†…å®¹**
   - å¢åŠ ä¿¡æ¯åˆ†æ•£åº¦
   - æ·»åŠ æ›´å¤šå¹²æ‰°æ–‡ä»¶
   - è°ƒæ•´çº¿ç´¢çš„éšè—ç¨‹åº¦

### ä¸èƒ½ä¿®æ”¹çš„éƒ¨åˆ†

**ä¸èƒ½**ä¿®æ”¹ï¼š

1. **Environment ç»“æ„**
   - ä¸èƒ½åˆ é™¤æ ¸å¿ƒæ–‡ä»¶
   - ä¸èƒ½å¤§æ”¹ç›®å½•ç»“æ„

2. **Golden Action**
   - ä¸èƒ½æ”¹å˜è§£é¢˜æ€è·¯
   - ä¸èƒ½å‡å°‘æ­¥éª¤æ•°

### å›ç‚‰åé‡æ–°éªŒè¯

ä¿®å¤åï¼Œé‡æ–°æ‰§è¡Œ Step 1-5ã€‚

---

## å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆä¸èƒ½å¤åˆ¶ case.jsonï¼Ÿ

**åŸå› **ï¼šcase.json åŒ…å«ç­”æ¡ˆï¼ˆreference_solution å’Œ gradersï¼‰

å¦‚æœ Haiku èƒ½è¯»å– case.jsonï¼Œå°±èƒ½ï¼š
- çœ‹åˆ° Golden Actionï¼ˆå‚è€ƒè§£ç­”ï¼‰
- çœ‹åˆ° Grader éªŒè¯æ¡ä»¶
- ç›´æ¥ä½œå¼Š

### Q2: å¦‚ä½•ç¡®ä¿ Haiku çœ‹ä¸åˆ°ç­”æ¡ˆï¼Ÿ

**æ–¹æ¡ˆ**ï¼š
1. åªå¤åˆ¶ç¯å¢ƒæ–‡ä»¶åˆ° haiku_space/
2. ä¸å¤åˆ¶ case.json
3. è„šæœ¬åªç»™ Haiku æä¾› Query
4. Haiku å·¥ä½œç›®å½•è®¾ç½®ä¸º haiku_space/

### Q3: Haiku ä¿®æ”¹äº†æ–‡ä»¶æ€ä¹ˆåŠï¼Ÿ

**æ²¡å…³ç³»**ï¼š
- Haiku åªä¿®æ”¹ haiku_space/ ä¸­çš„æ–‡ä»¶
- å·¥ä½œç›®å½•æ ¹çš„åŸå§‹ç¯å¢ƒä¸å—å½±å“
- ä½ ä»ç„¶å¯ä»¥ä¿å­˜å®Œæ•´çš„é¢˜ç›®

### Q4: å¦‚ä½•éªŒè¯è½¨è¿¹æ˜¯çœŸå®çš„ï¼Ÿ

**æ£€æŸ¥**ï¼š
- output å­—æ®µæ˜¯å®Œæ•´çš„åŸå§‹è¾“å‡ºï¼ˆä¸æ˜¯æ‘˜è¦ï¼‰
- æ²¡æœ‰ reasoning å­—æ®µï¼ˆçœŸå®è½¨è¿¹æ²¡æœ‰ï¼‰
- æ•°æ®ä¸ phase6_result.json å®Œå…¨ä¸€è‡´

### Q5: Haiku è¶…æ—¶æˆ–æ‰§è¡Œå¾ˆä¹…

**åŸå› **ï¼šé¢˜ç›®å¤ªå¤æ‚ï¼ŒHaiku åœ¨æ¢ç´¢ä¸­å¾ªç¯

**å¤„ç†**ï¼š
- æ£€æŸ¥ Query æ˜¯å¦æœ‰æ˜ç¡®çš„æ¢ç´¢æ–¹å‘
- ç¡®è®¤ç¯å¢ƒä¸­æœ‰è¶³å¤Ÿçš„çº¿ç´¢
- è€ƒè™‘é™ä½éš¾åº¦

---

## è„šæœ¬è¯¦ç»†å‚æ•°

phase6_haiku.py æ”¯æŒä»¥ä¸‹å‚æ•°ï¼š

| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `case_json_path` | æµ‹è¯•ç”¨ä¾‹ JSON æ–‡ä»¶è·¯å¾„ï¼ˆå¿…éœ€ï¼‰ | `case.json` æˆ–ç»å¯¹è·¯å¾„ |
| `--haiku-dir` | Haiku å·¥ä½œç›®å½•ï¼ˆå¿…éœ€ï¼‰ | `haiku_space/` |
| `-v, --verbose` | è¯¦ç»†è¾“å‡ºæ¨¡å¼ | `--verbose` |
| `--timeout` | Haiku æ‰§è¡Œè¶…æ—¶ï¼ˆç§’ï¼‰ | `--timeout 180` |

**å®Œæ•´ç¤ºä¾‹**ï¼š
```bash
python3 ~/.claude/skills/agent-testcase-generator/scripts/phase6_haiku.py case.json --haiku-dir haiku_space/ --verbose --timeout 120
```

**è¯¦ç»†å‚æ•°è¯´æ˜**ï¼š
```bash
Read ~/.claude/skills/agent-testcase-generator/reference/script_usage.md
```

---

## ä¸‹ä¸€æ­¥

å®Œæˆ Haiku éªŒè¯åï¼Œè¿›è¡Œæœ€ç»ˆè¾“å‡ºï¼š

1. å°† `haiku_evaluation` å’Œ `haiku_trajectory` æ·»åŠ åˆ° case.json
2. æ·»åŠ  `quality_analysis`ï¼ˆå¯ä½¿ç”¨ phase7_quality.pyï¼‰
3. ä¿å­˜æœ€ç»ˆçš„ case.json

**è¾“å‡ºæ ¼å¼è¯¦è§£**ï¼š
```bash
Read ~/.claude/skills/agent-testcase-generator/reference/output_format.md
```
